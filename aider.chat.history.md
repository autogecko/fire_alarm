# 프로젝트 이해도 요약

## 1. 프로젝트 목표
두 대 이상의 ESP32 보드가 Wi-Fi 공유기 없이 ESP-NOW 프로토콜을 이용해 직접 통신하는 시스템을 구축합니다. 시스템은 'Normal' 모드와 'Alarm' 모드로 동작하며, 한 보드의 상태가 변경되면 다른 보드에 즉시 전파되어 상태를 동기화하는 것을 목표로 합니다.

## 2. 핵심 기능 요구사항

### 가. 상태 머신 (State Machine)
- **`Normal_mode`**: 시스템의 기본 평상시 상태입니다.
- **`Alarm_mode`**: 센서 값이나 외부 신호에 의해 트리거되는 경보 상태입니다.

### 나. `Alarm_mode` 진입 조건
- DHT11 온도가 30°C를 초과할 경우.
- MQ7 가스 센서의 원시 값이 600을 초과할 경우.
- 외부 장치로부터 "Alarm" 신호를 수신할 경우.
- `Normal_mode`에서 사용자가 버튼을 누를 경우.

### 다. `Normal_mode` 진입 조건
- 외부 장치로부터 "normal" 신호를 수신할 경우.
- `Alarm_mode`에서 사용자가 버튼을 누를 경우.
- `Alarm_mode`에서 "Alarm" 신호를 다시 수신할 경우 (토글 동작).

### 라. 모드별 동작 (Actions)
- **`Alarm_mode` 동작**:
  - "Alarm" 메시지를 브로드캐스트합니다.
  - 상태 LED(`led_stat`): 0.5초 주기로 점멸(Blinking).
  - 스피커(`spk`): 1초마다 비프음 발생.
  - 레이저(`sw_laser`) 및 모터(`sw_motor`): 활성화(HIGH).
- **`Normal_mode` 동작**:
  - "normal" 메시지를 브로드캐스트합니다.
  - 상태 LED(`led_stat`): 계속 켜진 상태(ON) 유지.
  - 스피커, 레이저, 모터: 비활성화(OFF).

### 마. 시리얼 모니터링
- 1초 주기로 아래 정보를 출력합니다:
  - 장치의 IP 주소
  - 현재 동작 모드 (`Normal`/`Alarm`)
  - 버튼 눌림 상태
  - 마지막으로 수신한 외부 신호 (`LAST_RX`)

## 3. 현재 코드(`src/main.cpp`) 구현 현황 분석

### 가. 구현된 기능
- PlatformIO 프로젝트 스켈레톤 및 기본 설정.
- ESP-NOW 브로드캐스트 통신 초기화.
- 버튼(GPIO 32) 입력 및 디바운싱 로직.
- **상태 변경 로직**:
  - **버튼 입력 시**: 현재 모드(`Normal`↔`Alarm`)를 **토글**하고, "alarm" 메시지를 1회 전송합니다.
  - **"alarm" 신호 수신 시**: 현재 모드를 **토글**합니다.
- **출력 동작**:
  - `Alarm_mode`에서 내장 LED(GPIO 2)가 300ms 주기로 점멸합니다.
  - `Normal_mode`에서 내장 LED는 꺼집니다(LOW).
- 2초 주기로 IP 주소, 모드, 버튼 상태를 시리얼 모니터에 출력합니다.

### 나. 추가/수정이 필요한 기능 (요구사항 대비)
- **센서 연동**: DHT11, MQ7 센서 값을 읽고 `Alarm_mode`를 자동으로 트리거하는 로직이 필요합니다.
- **출력 장치 제어**: 스피커, 레이저, 모터 제어 로직 구현이 필요합니다.
- **`Normal_mode` LED 동작**: 요구사항은 'ON' 상태 유지이지만, 현재 코드는 'OFF'로 되어 있어 수정이 필요합니다.
- **통신 프로토콜 확장**:
  - "normal" 메시지를 전송하는 기능 추가가 필요합니다.
  - 현재는 버튼 입력 시에만 메시지를 전송하나, 주기적인 상태 브로드캐스트 기능 구현이 필요할 수 있습니다.
  - 현재 수신 로직은 '토글' 방식이므로, 수신된 메시지에 따라 상태를 '동기화'하는 방식으로 수정이 필요합니다.
- **시리얼 모니터링**: 마지막 수신 신호(`LAST_RX`)를 추적하고 출력하는 기능 추가가 필요합니다.
