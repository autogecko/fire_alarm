# 프로젝트 이해도 요약

## 1. 프로젝트 목표
두 대 이상의 ESP32 보드가 Wi-Fi 공유기 없이 ESP-NOW 프로토콜을 이용해 직접 통신하는 시스템을 구축합니다. 시스템은 'Normal' 모드와 'Alarm' 모드로 동작하며, 한 보드의 상태가 변경되면 다른 보드에 즉시 전파되어 상태를 동기화하는 것을 목표로 합니다.

## 2. 핵심 기능 요구사항 (todo_list.md 및 temp.md 기반 최신화)

### 가. 상태 머신 (State Machine)
- **`Normal_mode`**: 시스템의 기본 평상시 상태입니다.
- **`Alarm_mode`**: 외부 신호에 의해 트리거되는 경보 상태입니다.

### 나. 통신 프로토콜
- **주기적 상태 전파**: 각 보드는 500ms(`MODE_BROADCAST_INTERVAL_MS`) 주기로 자신의 현재 상태("normal" 또는 "alarm")를 브로드캐스트합니다.
- **수신 시 상태 동기화**: 메시지를 수신한 보드는 즉시 송신 측의 상태와 자신의 상태를 동기화합니다.
  - "normal" 수신 시 → `Normal_mode`로 전환
  - "alarm" 수신 시 → `Alarm_mode`로 전환

### 다. 사용자 입력 (버튼)
- 버튼을 짧게 누르면, 현재 모드의 **반대** 상태에 해당하는 메시지를 1회 브로드캐스트합니다.
- **자신의 상태는 변경하지 않습니다.** (예: Normal_mode에서 버튼 누르면 "alarm" 메시지만 전송하고 자신은 Normal_mode 유지)

### 라. 출력 동작
- **상태 LED**: `Normal_mode`와 `Alarm_mode` **모두**에서 300ms(`LED_TOGGLE_INTERVAL_MS`) 주기로 점멸(Blinking)합니다. 모드에 따라 LED 동작이 달라지지 않습니다.

### 마. 시리얼 모니터링
- 2초(`STATUS_PRINT_INTERVAL_MS`) 주기로 아래 정보를 출력합니다:
  - 현재 동작 모드 (`Normal`/`Alarm`)
  - 장치의 IP 주소
  - 마지막으로 수신한 외부 신호 (`LAST_RX`: "normal", "alarm", 또는 없음)

## 3. 현재 코드(`src/main.cpp`) 구현 현황 분석 (요구사항 대비)

### 가. 구현된 기능
- PlatformIO 프로젝트 스켈레톤 및 기본 설정.
- ESP-NOW 브로드캐스트 통신 초기화.
- 버튼(GPIO 32) 입력 및 디바운싱 로직.
- `Normal`/`Alarm` 상태 머신 기본 구조.

### 나. 추가/수정이 필요한 기능
- **통신 로직**:
  - **주기적 브로드캐스트**: 현재 모드("normal" 또는 "alarm")를 주기적으로 전송하는 기능이 누락되어 있습니다.
  - **"normal" 메시지 전송**: "alarm" 메시지만 전송하고 있으며, "normal" 메시지 전송 기능 추가가 필요합니다.
  - **수신 로직**: 수신된 메시지에 따라 상태를 **'동기화'(설정)**해야 하지만, 현재는 "alarm" 수신 시 상태를 **'토글'**하고 있습니다. "normal" 메시지 처리 로직도 필요합니다.
- **버튼 동작**:
  - 현재 버튼을 누르면 자신의 상태를 **변경**합니다. 요구사항은 자신의 상태는 **유지**하고 반대 상태 메시지만 **전송**하는 것입니다.
- **LED 동작**:
  - 현재 `Alarm_mode`에서만 LED가 점멸하고 `Normal_mode`에서는 꺼집니다. 요구사항은 **두 모드 모두에서 점멸**하는 것입니다.
- **시리얼 모니터링**:
  - 마지막으로 수신한 신호(`LAST_RX`)를 추적하고 출력하는 기능 추가가 필요합니다.
